import com.stack_advisor.stack_advisor_backend.models.TechnologyRecommendation
import com.stack_advisor.stack_advisor_backend.models.RuleExecutionLog
import com.stack_advisor.stack_advisor_backend.models.ProjectRequirements
import com.stack_advisor.stack_advisor_backend.models.Technology

import com.stack_advisor.stack_advisor_backend.services.AuditLogService
import java.util.List

global List recommendations
global AuditLogService auditLogService

rule "Recommended unknown category for unknown project type or for none team experience"
    when
        $req: ProjectRequirements(
            projectType == ProjectRequirements.ProjectType.UNKNOWN || teamExperience == ProjectRequirements.TeamExperience.NONE
        )
        $tech: Technology(
            category == Technology.TechnologyCategory.UNKNOWN
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.89);
        rec.setReason("Неизвестная категория для тех, кто не знает, что ему нужно");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Unknown category", "Unknown project, none experience");
end

rule "Recommend Spring Boot for Enterprise Web Application"
    when
        $req: ProjectRequirements(
            projectType == ProjectRequirements.ProjectType.WEB,
            teamExperience == ProjectRequirements.TeamExperience.JAVA,
            budget == ProjectRequirements.BudgetLevel.HIGH,
            needHighLoad == true
        )
        $tech: Technology(
            name == "Spring Boot",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.95);
        rec.setReason("Spring Boot - лучший выбор для enterprise веб-приложений на Java с высокой нагрузкой");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Spring Boot selected for enterprise web", "Java team, high budget, high load");
end


rule "Recommend Node.js for Real-time Fast Development"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            needRealTime == true,
            timeToMarket == ProjectRequirements.TimeToMarket.FAST,
            teamExperience in (ProjectRequirements.TeamExperience.JAVASCRIPT, ProjectRequirements.TeamExperience.MIXED)
        )
        $tech: Technology(
            name == "Node.js",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.90);
        rec.setReason("Node.js с event-driven архитектурой идеален для real-time приложений и быстрой разработки");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Node.js for real-time", "Real-time required, fast development");
end


rule "Recommend Django for Rapid Prototyping"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            projectType not in (ProjectRequirements.ProjectType.MOBILE, ProjectRequirements.ProjectType.DESKTOP, ProjectRequirements.ProjectType.GAME),
            timeToMarket == ProjectRequirements.TimeToMarket.FAST,
            teamSize == ProjectRequirements.TeamSize.SMALL,
            budget == ProjectRequirements.BudgetLevel.LOW
        )
        $tech: Technology(
            name == "Django",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.85);
        rec.setReason("Django с batteries-included подходом позволяет быстро создать прототип");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Django for prototyping", "Fast time-to-market, small team, low budget");
end


rule "Recommend .NET for High Load Enterprise"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            projectType not in (ProjectRequirements.ProjectType.MOBILE, ProjectRequirements.ProjectType.DESKTOP, ProjectRequirements.ProjectType.GAME),
            needHighLoad == true,
            needHighSecurity == true,
            budget == ProjectRequirements.BudgetLevel.ENTERPRISE
        )
        $tech: Technology(
            name == "ASP.NET Core",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.92);
        rec.setReason("ASP.NET Core предоставляет enterprise-уровень производительности и безопасности");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation(".NET for enterprise", "High load, high security, enterprise budget");
end


rule "Recommend Go for Microservices Performance"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            needHighLoad == true,
            teamSize == ProjectRequirements.TeamSize.MEDIUM,
            budget == ProjectRequirements.BudgetLevel.HIGH
        )
        $tech: Technology(
            name == "Go (Golang)",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.88);
        rec.setReason("Go обеспечивает высокую производительность и идеален для микросервисной архитектуры");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Go for microservices", "High load, medium team, high budget");
end


rule "Recommend Laravel for Small Business Projects"
    when
        $req: ProjectRequirements(
            budget == ProjectRequirements.BudgetLevel.LOW,
            teamExperience == ProjectRequirements.TeamExperience.PHP,
            projectType == ProjectRequirements.ProjectType.WEB
        )
        $tech: Technology(
            name == "Laravel",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.80);
        rec.setReason("Laravel отлично подходит для небольших бизнес-проектов с PHP стеком");
        rec.setPriority(3);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Laravel for small business", "Low budget, PHP team, web project");
end


rule "Recommend Spring Boot as Java Alternative"
    when
        $req: ProjectRequirements(
            teamExperience == ProjectRequirements.TeamExperience.JAVA,
            projectType == ProjectRequirements.ProjectType.WEB,
            budget != ProjectRequirements.BudgetLevel.LOW
        )
        $tech: Technology(
            name == "Spring Boot",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.75);
        rec.setReason("Spring Boot как стандартный выбор для Java веб-разработки");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Spring Boot alternative", "Java team, web project, not low budget");
end


rule "Not Recommend Django for High Load"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            projectType not in (ProjectRequirements.ProjectType.MOBILE, ProjectRequirements.ProjectType.DESKTOP, ProjectRequirements.ProjectType.GAME),
            needHighLoad == true,
            budget == ProjectRequirements.BudgetLevel.HIGH
        )
        $tech: Technology(
            name == "Django",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.60);
        rec.setReason("Django может не справиться с экстремально высокой нагрузкой в enterprise проектах");
        rec.setPriority(5);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.NOT_RECOMMENDED);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Avoid Django for high load", "High load, high budget");
end


rule "Recommend Kotlin for Modern Android"
    when
        $req: ProjectRequirements(
            projectType == ProjectRequirements.ProjectType.MOBILE,
            teamExperience == ProjectRequirements.TeamExperience.JAVA
        )
        $tech: Technology(
            name == "Kotlin",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.90);
        rec.setReason("Kotlin - рекомендованный Google язык для разработки под Android");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Kotlin for Android", "Mobile project, Java team");
end


rule "Recommend Ruby on Rails for MVP"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            timeToMarket == ProjectRequirements.TimeToMarket.FAST,
            budget == ProjectRequirements.BudgetLevel.LOW,
            teamSize == ProjectRequirements.TeamSize.SMALL
        )
    then

        auditLogService.logInfo("Consider Ruby on Rails for MVP development");
end


rule "Recommend NestJS for TypeScript Enterprise"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            projectType not in (ProjectRequirements.ProjectType.MOBILE, ProjectRequirements.ProjectType.DESKTOP, ProjectRequirements.ProjectType.GAME),
            teamExperience == ProjectRequirements.TeamExperience.JAVASCRIPT,
            budget == ProjectRequirements.BudgetLevel.ENTERPRISE,
            needHighSecurity == true
        )
        $tech: Technology(
            name == "NestJS",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.87);
        rec.setReason("NestJS предоставляет архитектуру, похожую на Angular, для enterprise Node.js проектов");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("NestJS for TypeScript enterprise", "JS team, enterprise, high security");
end


rule "Recommend Elixir for Scalable Real-time"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            needRealTime == true,
            needHighLoad == true,
            teamSize == ProjectRequirements.TeamSize.SMALL
        )
    then
        auditLogService.logInfo("Consider Elixir Phoenix for highly scalable real-time systems");
end


rule "Recommend Quarkus for Cloud Native Java"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            teamExperience == ProjectRequirements.TeamExperience.JAVA,
            budget == ProjectRequirements.BudgetLevel.HIGH,
            needHighLoad == true
        )
        $tech: Technology(
            name == "Quarkus",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.85);
        rec.setReason("Quarkus оптимизирован для cloud-native приложений и Kubernetes");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Quarkus for cloud-native", "Java team, high budget, high load");
end


rule "Recommend Micronaut for Serverless"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            teamExperience == ProjectRequirements.TeamExperience.JAVA,
            timeToMarket == ProjectRequirements.TimeToMarket.FAST
        )
        $tech: Technology(
            name == "Micronaut",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.78);
        rec.setReason("Micronaut имеет быстрый старт и идеален для serverless архитектуры");
        rec.setPriority(3);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Micronaut for serverless", "Java team, fast development");
end


rule "Recommend Flask for Lightweight Python API"
    when
        $req: ProjectRequirements(
            teamExperience == ProjectRequirements.TeamExperience.PYTHON,
            timeToMarket == ProjectRequirements.TimeToMarket.FAST,
            projectType == ProjectRequirements.ProjectType.WEB
        )
        $tech: Technology(
            name == "Flask",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.82);
        rec.setReason("Flask - минималистичный фреймворк для быстрого создания Python API");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Flask for lightweight API", "Python team, fast development, web project");
end


rule "Recommend Express.js for Simple Node.js"
    when
        $req: ProjectRequirements(
            teamExperience == ProjectRequirements.TeamExperience.JAVASCRIPT,
            budget == ProjectRequirements.BudgetLevel.LOW,
            projectType == ProjectRequirements.ProjectType.WEB
        )
        $tech: Technology(
            name == "Express.js",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.80);
        rec.setReason("Express.js - минималистичный фреймворк для простых Node.js приложений");
        rec.setPriority(3);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Express.js for simple projects", "JS team, low budget, web project");
end


rule "Recommend Spring Cloud for Java Microservices"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            projectType not in (ProjectRequirements.ProjectType.MOBILE, ProjectRequirements.ProjectType.DESKTOP, ProjectRequirements.ProjectType.GAME),
            teamExperience == ProjectRequirements.TeamExperience.JAVA,
            budget == ProjectRequirements.BudgetLevel.ENTERPRISE,
            needHighLoad == true
        )
        $tech: Technology(
            name == "Spring Cloud",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.93);
        rec.setReason("Spring Cloud предоставляет полный стек для enterprise микросервисов на Java");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Spring Cloud for microservices", "Java team, enterprise, high load");
end


rule "Recommend GraphQL for Flexible APIs"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            needRealTime == true,
            teamSize == ProjectRequirements.TeamSize.MEDIUM,
            budget == ProjectRequirements.BudgetLevel.HIGH
        )
        $tech: Technology(
            name == "GraphQL",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.79);
        rec.setReason("GraphQL обеспечивает гибкость в работе с данными для сложных API");
        rec.setPriority(3);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("GraphQL for flexible APIs", "Real-time, medium team, high budget");
end


rule "Recommend gRPC for High Performance Services"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            needHighLoad == true,
            teamSize == ProjectRequirements.TeamSize.LARGE,
            budget == ProjectRequirements.BudgetLevel.ENTERPRISE
        )
        $tech: Technology(
            name == "gRPC",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.88);
        rec.setReason("gRPC обеспечивает высокую производительность для межсервисного взаимодействия");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("gRPC for high performance", "High load, large team, enterprise");
end


rule "Recommend React for Complex SPA Applications"
    when
        $req: ProjectRequirements(
            projectType == ProjectRequirements.ProjectType.WEB,
            teamExperience in (ProjectRequirements.TeamExperience.JAVASCRIPT, ProjectRequirements.TeamExperience.MIXED),
            budget != ProjectRequirements.BudgetLevel.LOW
        )
        $tech: Technology(
            name == "React",
            category == Technology.TechnologyCategory.FRONTEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.92);
        rec.setReason("React с большой экосистемой и сообществом идеален для сложных SPA");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("React for complex SPA", "Web project, JS/Mixed team, not low budget");
end


rule "Recommend Vue.js for Rapid Development"
    when
        $req: ProjectRequirements(
            projectType == ProjectRequirements.ProjectType.WEB,
            timeToMarket == ProjectRequirements.TimeToMarket.FAST,
            teamSize == ProjectRequirements.TeamSize.SMALL,
            teamExperience == ProjectRequirements.TeamExperience.NONE,
            projectType != ProjectRequirements.ProjectType.UNKNOWN
        )
        $tech: Technology(
            name == "Vue.js",
            category == Technology.TechnologyCategory.FRONTEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.85);
        rec.setReason("Vue.js легко изучать и он позволяет быстро разрабатывать интерфейсы");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Vue.js for rapid development", "Fast time-to-market, small team, no experience");
end


rule "Recommend Angular for Enterprise Applications"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            budget == ProjectRequirements.BudgetLevel.ENTERPRISE,
            teamSize == ProjectRequirements.TeamSize.LARGE,
            needHighSecurity == true
        )
        $tech: Technology(
            name == "Angular",
            category == Technology.TechnologyCategory.FRONTEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.90);
        rec.setReason("Angular предоставляет полный фреймворк с TypeScript для больших enterprise приложений");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Angular for enterprise", "Enterprise budget, large team, high security");
end


rule "Recommend React Native for Cross-platform Mobile"
    when
        $req: ProjectRequirements(
            projectType == ProjectRequirements.ProjectType.MOBILE,
            teamExperience == ProjectRequirements.TeamExperience.JAVASCRIPT,
            budget == ProjectRequirements.BudgetLevel.MEDIUM
        )
        $tech: Technology(
            name == "React Native",
            category == Technology.TechnologyCategory.MOBILE_HYBRID
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.87);
        rec.setReason("React Native позволяет разрабатывать для iOS и Android с одним кодом на JavaScript");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("React Native for cross-platform", "Mobile project, JS team, medium budget");
end


rule "Recommend Flutter for High Performance Mobile"
    when
        $req: ProjectRequirements(
            projectType == ProjectRequirements.ProjectType.MOBILE,
            needHighLoad == true,
            budget == ProjectRequirements.BudgetLevel.HIGH
        )
        $tech: Technology(
            name == "Flutter",
            category == Technology.TechnologyCategory.MOBILE_HYBRID
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.89);
        rec.setReason("Flutter обеспечивает нативную производительность с кроссплатформенной разработкой");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Flutter for performance", "Mobile project, high load, high budget");
end


rule "Recommend Svelte for Small Fast Applications"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            teamSize == ProjectRequirements.TeamSize.SMALL,
            timeToMarket == ProjectRequirements.TimeToMarket.FAST,
            budget == ProjectRequirements.BudgetLevel.LOW
        )
        $tech: Technology(
            name == "Svelte",
            category == Technology.TechnologyCategory.FRONTEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.83);
        rec.setReason("Svelte компилируется в эффективный vanilla JavaScript, идеален для небольших проектов");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Svelte for small projects", "Small team, fast development, low budget");
end


rule "Recommend Next.js for SEO Optimized Apps"
    when
        $req: ProjectRequirements(
            projectType == ProjectRequirements.ProjectType.WEB,
            needHighLoad == true,
            teamExperience == ProjectRequirements.TeamExperience.JAVASCRIPT
        )
        $tech: Technology(
            name == "Next.js",
            category == Technology.TechnologyCategory.FRONTEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.86);
        rec.setReason("Next.js обеспечивает server-side rendering для лучшей SEO оптимизации");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Next.js for SEO", "Web project, high load, JS team");
end


rule "Recommend Nuxt.js for Vue SSR"
    when
        $req: ProjectRequirements(
            projectType == ProjectRequirements.ProjectType.WEB,
            needHighLoad == true
        )
        $tech: Technology(
            name == "Nuxt.js",
            category == Technology.TechnologyCategory.FRONTEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.82);
        rec.setReason("Nuxt.js добавляет server-side rendering к Vue.js для лучшей производительности");
        rec.setPriority(3);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Nuxt.js for Vue SSR", "Web project, high load");
end


rule "Recommend TypeScript for Enterprise JavaScript"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            budget == ProjectRequirements.BudgetLevel.ENTERPRISE,
            teamSize == ProjectRequirements.TeamSize.LARGE,
            needHighSecurity == true
        )
        $tech: Technology(
            name == "TypeScript",
            category == Technology.TechnologyCategory.FRONTEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.94);
        rec.setReason("TypeScript добавляет статическую типизацию для повышения надежности enterprise приложений");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("TypeScript for enterprise JS", "Enterprise, large team, high security");
end


rule "Recommend Redux for Large Application State"
    when
        $req: ProjectRequirements(
            teamSize == ProjectRequirements.TeamSize.LARGE,
            budget == ProjectRequirements.BudgetLevel.HIGH,
            projectType == ProjectRequirements.ProjectType.WEB
        )
        $tech: Technology(
            name == "Redux",
            category == Technology.TechnologyCategory.FRONTEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.80);
        rec.setReason("Redux обеспечивает предсказуемое управление состоянием в больших приложениях");
        rec.setPriority(3);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Redux for state management", "Large team, high budget, web project");
end


rule "Recommend PostgreSQL for Complex Transactions"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            needHighSecurity == true,
            budget != ProjectRequirements.BudgetLevel.LOW
        )
        $tech: Technology(
            name == "PostgreSQL",
            category == Technology.TechnologyCategory.DATABASE
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.95);
        rec.setReason("PostgreSQL обеспечивает полную ACID compliance и расширенные возможности SQL");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("PostgreSQL for transactions", "High security, not low budget");
end


rule "Recommend MongoDB for Flexible Schema"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            timeToMarket == ProjectRequirements.TimeToMarket.FAST,
            teamSize == ProjectRequirements.TeamSize.SMALL
        )
        $tech: Technology(
            name == "MongoDB",
            category == Technology.TechnologyCategory.DATABASE
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.88);
        rec.setReason("MongoDB позволяет быстро итерировать схему данных на ранних стадиях проекта");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("MongoDB for flexible schema", "Fast development, small team");
end


rule "Recommend Redis for Caching and Real-time"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            needRealTime == true,
            needHighLoad == true
        )
        $tech: Technology(
            name == "Redis",
            category == Technology.TechnologyCategory.DATABASE
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.90);
        rec.setReason("Redis как in-memory data store идеален для кэширования и real-time приложений");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Redis for caching", "Real-time, high load");
end


rule "Recommend MySQL for Budget Web Applications"
    when
        $req: ProjectRequirements(
            budget == ProjectRequirements.BudgetLevel.LOW,
            projectType == ProjectRequirements.ProjectType.WEB
        )
        $tech: Technology(
            name == "MySQL",
            category == Technology.TechnologyCategory.DATABASE
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.82);
        rec.setReason("MySQL - надежная и проверенная СУБД для веб-приложений с ограниченным бюджетом");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("MySQL for budget web", "Low budget, web project");
end


rule "Recommend Cassandra for Big Data Scaling"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            needHighLoad == true,
            budget == ProjectRequirements.BudgetLevel.ENTERPRISE
        )
        $tech: Technology(
            name == "Apache Cassandra",
            category == Technology.TechnologyCategory.DATABASE
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.87);
        rec.setReason("Cassandra обеспечивает линейное горизонтальное масштабирование для больших данных");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Cassandra for big data", "High load, enterprise budget");
end


rule "Recommend Elasticsearch for Search and Analytics"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            needRealTime == true,
            teamSize == ProjectRequirements.TeamSize.MEDIUM,
            budget == ProjectRequirements.BudgetLevel.HIGH
        )
        $tech: Technology(
            name == "Elasticsearch",
            category == Technology.TechnologyCategory.DATABASE
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.85);
        rec.setReason("Elasticsearch обеспечивает мощный полнотекстовый поиск и аналитику в реальном времени");
        rec.setPriority(3);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Elasticsearch for search", "Real-time, medium team, high budget");
end


rule "Recommend SQLite for Embedded and Mobile"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            projectType in (ProjectRequirements.ProjectType.MOBILE, ProjectRequirements.ProjectType.DESKTOP),
            teamSize == ProjectRequirements.TeamSize.SMALL
        )
        $tech: Technology(
            name == "SQLite",
            category == Technology.TechnologyCategory.DATABASE
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.89);
        rec.setReason("SQLite - встроенная СУБД, идеальная для мобильных и десктоп приложений");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("SQLite for embedded", "Mobile/Desktop project, small team");
end


rule "Recommend DynamoDB for AWS Serverless"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            budget == ProjectRequirements.BudgetLevel.HIGH,
            needHighLoad == true
        )
        $tech: Technology(
            name == "Amazon DynamoDB",
            category == Technology.TechnologyCategory.DATABASE
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.83);
        rec.setReason("DynamoDB обеспечивает автоматическое масштабирование для serverless приложений на AWS");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("DynamoDB for serverless", "High budget, high load");
end


rule "Recommend TimescaleDB for Time Series"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            needRealTime == true,
            teamSize == ProjectRequirements.TeamSize.MEDIUM
        )
        $tech: Technology(
            name == "TimescaleDB",
            category == Technology.TechnologyCategory.DATABASE
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.84);
        rec.setReason("TimescaleDB оптимизирован для хранения и обработки данных временных рядов");
        rec.setPriority(3);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("TimescaleDB for time series", "Real-time, medium team");
end

rule "Recommend Kafka for Stream Processing"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            needRealTime == true,
            needHighLoad == true,
            budget == ProjectRequirements.BudgetLevel.ENTERPRISE
        )
        $tech: Technology(
            name == "Apache Kafka",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.91);
        rec.setReason("Kafka - лидер в обработке потоков данных в реальном времени");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Kafka for stream processing", "Real-time, high load, enterprise");
end


rule "Recommend RabbitMQ for Message Queue"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            needRealTime == true,
            teamSize == ProjectRequirements.TeamSize.MEDIUM
        )
        $tech: Technology(
            name == "RabbitMQ",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.84);
        rec.setReason("RabbitMQ предоставляет надежную систему очередей сообщений");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("RabbitMQ for message queue", "Real-time, medium team");
end


rule "Recommend OpenAPI for API Documentation"
    when
        $req: ProjectRequirements(
            projectType != ProjectRequirements.ProjectType.UNKNOWN,
            teamSize == ProjectRequirements.TeamSize.MEDIUM,
            budget == ProjectRequirements.BudgetLevel.HIGH
        )
        $tech: Technology(
            name == "OpenAPI (Swagger)",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.89);
        rec.setReason("OpenAPI стандартизирует документацию и тестирование REST API");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("OpenAPI for API docs", "Medium team, high budget");
end

rule "Recommended IOS for project with high Budget"
    when
        $req: ProjectRequirements(
            projectType == ProjectRequirements.ProjectType.MOBILE,
            budget == ProjectRequirements.BudgetLevel.HIGH
        )
        $tech: Technology(
            category == Technology.TechnologyCategory.IOS
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.89);
        rec.setReason("IOS для проектов с крупным бюджетом");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("IOS for high budget", "Mobile project, high budget");
end

rule "Recommended Android for project with another budget"
    when
        $req: ProjectRequirements(
            projectType == ProjectRequirements.ProjectType.MOBILE,
            timeToMarket != ProjectRequirements.TimeToMarket.FAST,
            budget != ProjectRequirements.BudgetLevel.HIGH
        )
        $tech: Technology(
            category == Technology.TechnologyCategory.ANDROID
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.89);
        rec.setReason("Android для проектов с невысоким бюджетом");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Android for nothigh budget", "Mobile project, nothigh budget");
end

rule "Recommended MOBILE_HYBRID for mobile projects with fast time to market and medium budget"
    when
        $req: ProjectRequirements(
            projectType == ProjectRequirements.ProjectType.MOBILE,
            timeToMarket == ProjectRequirements.TimeToMarket.FAST,
            budget == ProjectRequirements.BudgetLevel.MEDIUM
        )
        $tech: Technology(
            category == Technology.TechnologyCategory.MOBILE_HYBRID
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.89);
        rec.setReason("MOBILE_HYBRID для мобильных проектов с невысоким бюджетом");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("MOBILE_HYBRID for medium budget", "Mobile project, medium budget, fast time to market");
end