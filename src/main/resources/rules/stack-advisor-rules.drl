import com.stack_advisor.stack_advisor_backend.models.TechnologyRecommendation
import com.stack_advisor.stack_advisor_backend.models.RuleExecutionLog
import com.stack_advisor.stack_advisor_backend.models.ProjectRequirements
import com.stack_advisor.stack_advisor_backend.models.Technology

import com.stack_advisor.stack_advisor_backend.services.AuditLogService
import java.util.List

global List recommendations
global AuditLogService auditLogService

// Правило 1: Java Spring Boot для enterprise веб-приложений
rule "Recommend Spring Boot for Enterprise Web Application"
    when
        $req: ProjectRequirements(
            projectType == ProjectRequirements.ProjectType.WEB,
            teamExperience == ProjectRequirements.TeamExperience.JAVA,
            budget == ProjectRequirements.BudgetLevel.HIGH,
            needHighLoad == true
        )
        $tech: Technology(
            name == "Spring Boot",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.95);
        rec.setReason("Spring Boot - лучший выбор для enterprise веб-приложений на Java с высокой нагрузкой");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Spring Boot selected for enterprise web", "Java team, high budget, high load");
end

// Правило 2: Node.js для real-time и быстрого старта
rule "Recommend Node.js for Real-time Fast Development"
    when
        $req: ProjectRequirements(
            needRealTime == true,
            timeToMarket == ProjectRequirements.TimeToMarket.FAST,
            teamExperience in (ProjectRequirements.TeamExperience.JAVASCRIPT, ProjectRequirements.TeamExperience.MIXED)
        )
        $tech: Technology(
            name == "Node.js",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.90);
        rec.setReason("Node.js с event-driven архитектурой идеален для real-time приложений и быстрой разработки");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Node.js for real-time", "Real-time required, fast development");
end

// Правило 3: Python Django для быстрого прототипирования
rule "Recommend Django for Rapid Prototyping"
    when
        $req: ProjectRequirements(
            timeToMarket == ProjectRequirements.TimeToMarket.FAST,
            teamSize == ProjectRequirements.TeamSize.SMALL,
            budget == ProjectRequirements.BudgetLevel.LOW
        )
        $tech: Technology(
            name == "Django",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.85);
        rec.setReason("Django с batteries-included подходом позволяет быстро создать прототип");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Django for prototyping", "Fast time-to-market, small team, low budget");
end

// Правило 4: .NET для высоконагруженных enterprise систем
rule "Recommend .NET for High Load Enterprise"
    when
        $req: ProjectRequirements(
            needHighLoad == true,
            needHighSecurity == true,
            budget == ProjectRequirements.BudgetLevel.ENTERPRISE
        )
        $tech: Technology(
            name == "ASP.NET Core",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.92);
        rec.setReason("ASP.NET Core предоставляет enterprise-уровень производительности и безопасности");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation(".NET for enterprise", "High load, high security, enterprise budget");
end

// Правило 5: Go для микросервисов и высокой производительности
rule "Recommend Go for Microservices Performance"
    when
        $req: ProjectRequirements(
            needHighLoad == true,
            teamSize == ProjectRequirements.TeamSize.MEDIUM,
            budget == ProjectRequirements.BudgetLevel.HIGH
        )
        $tech: Technology(
            name == "Go (Golang)",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.88);
        rec.setReason("Go обеспечивает высокую производительность и идеален для микросервисной архитектуры");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Go for microservices", "High load, medium team, high budget");
end

// Правило 6: PHP Laravel для небольших бизнес-проектов
rule "Recommend Laravel for Small Business Projects"
    when
        $req: ProjectRequirements(
            budget == ProjectRequirements.BudgetLevel.LOW,
            teamExperience == ProjectRequirements.TeamExperience.PHP,
            projectType == ProjectRequirements.ProjectType.WEB
        )
        $tech: Technology(
            name == "Laravel",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.80);
        rec.setReason("Laravel отлично подходит для небольших бизнес-проектов с PHP стеком");
        rec.setPriority(3);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Laravel for small business", "Low budget, PHP team, web project");
end

// Правило 7: Spring Boot как альтернатива для Java проектов
rule "Recommend Spring Boot as Java Alternative"
    when
        $req: ProjectRequirements(
            teamExperience == ProjectRequirements.TeamExperience.JAVA,
            projectType == ProjectRequirements.ProjectType.WEB,
            budget != ProjectRequirements.BudgetLevel.LOW
        )
        $tech: Technology(
            name == "Spring Boot",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.75);
        rec.setReason("Spring Boot как стандартный выбор для Java веб-разработки");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Spring Boot alternative", "Java team, web project, not low budget");
end

// Правило 8: Не рекомендовать Django для high-load
rule "Not Recommend Django for High Load"
    when
        $req: ProjectRequirements(
            needHighLoad == true,
            budget == ProjectRequirements.BudgetLevel.HIGH
        )
        $tech: Technology(
            name == "Django",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.60);
        rec.setReason("Django может не справиться с экстремально высокой нагрузкой в enterprise проектах");
        rec.setPriority(5);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.NOT_RECOMMENDED);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Avoid Django for high load", "High load, high budget");
end

// Правило 9: Kotlin для современных Android приложений
rule "Recommend Kotlin for Modern Android"
    when
        $req: ProjectRequirements(
            projectType == ProjectRequirements.ProjectType.MOBILE,
            teamExperience == ProjectRequirements.TeamExperience.JAVA
        )
        $tech: Technology(
            name == "Kotlin",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.90);
        rec.setReason("Kotlin - рекомендованный Google язык для разработки под Android");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Kotlin for Android", "Mobile project, Java team");
end

// Правило 10: Ruby on Rails для MVP и стартапов
rule "Recommend Ruby on Rails for MVP"
    when
        $req: ProjectRequirements(
            timeToMarket == ProjectRequirements.TimeToMarket.FAST,
            budget == ProjectRequirements.BudgetLevel.LOW,
            teamSize == ProjectRequirements.TeamSize.SMALL
        )
    then
        // Ruby on Rails может быть добавлен в базу технологий
        auditLogService.logInfo("Consider Ruby on Rails for MVP development");
end

// Правило 11: FastAPI для AI/ML проектов на Python
rule "Recommend FastAPI for AI ML Projects"
    when
        $req: ProjectRequirements(
            projectType == ProjectRequirements.ProjectType.AI_ML,
            teamExperience == ProjectRequirements.TeamExperience.PYTHON
        )
        $tech: Technology(
            name == "FastAPI",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.92);
        rec.setReason("FastAPI обеспечивает высокую производительность для AI/ML API");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("FastAPI for AI/ML", "AI/ML project, Python team");
end

// Правило 12: NestJS для TypeScript enterprise проектов
rule "Recommend NestJS for TypeScript Enterprise"
    when
        $req: ProjectRequirements(
            teamExperience == ProjectRequirements.TeamExperience.JAVASCRIPT,
            budget == ProjectRequirements.BudgetLevel.ENTERPRISE,
            needHighSecurity == true
        )
        $tech: Technology(
            name == "NestJS",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.87);
        rec.setReason("NestJS предоставляет архитектуру, похожую на Angular, для enterprise Node.js проектов");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("NestJS for TypeScript enterprise", "JS team, enterprise, high security");
end

// Правило 13: Elixir Phoenix для real-time систем
rule "Recommend Elixir for Scalable Real-time"
    when
        $req: ProjectRequirements(
            needRealTime == true,
            needHighLoad == true,
            teamSize == ProjectRequirements.TeamSize.SMALL
        )
    then
        auditLogService.logInfo("Consider Elixir Phoenix for highly scalable real-time systems");
end

// Правило 14: Quarkus для cloud-native Java
rule "Recommend Quarkus for Cloud Native Java"
    when
        $req: ProjectRequirements(
            teamExperience == ProjectRequirements.TeamExperience.JAVA,
            budget == ProjectRequirements.BudgetLevel.HIGH,
            needHighLoad == true
        )
        $tech: Technology(
            name == "Quarkus",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.85);
        rec.setReason("Quarkus оптимизирован для cloud-native приложений и Kubernetes");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Quarkus for cloud-native", "Java team, high budget, high load");
end

// Правило 15: Micronaut для serverless Java
rule "Recommend Micronaut for Serverless"
    when
        $req: ProjectRequirements(
            teamExperience == ProjectRequirements.TeamExperience.JAVA,
            timeToMarket == ProjectRequirements.TimeToMarket.FAST
        )
        $tech: Technology(
            name == "Micronaut",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.78);
        rec.setReason("Micronaut имеет быстрый старт и идеален для serverless архитектуры");
        rec.setPriority(3);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Micronaut for serverless", "Java team, fast development");
end

// Правило 16: Flask для легких Python API
rule "Recommend Flask for Lightweight Python API"
    when
        $req: ProjectRequirements(
            teamExperience == ProjectRequirements.TeamExperience.PYTHON,
            timeToMarket == ProjectRequirements.TimeToMarket.FAST,
            projectType == ProjectRequirements.ProjectType.WEB
        )
        $tech: Technology(
            name == "Flask",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.82);
        rec.setReason("Flask - минималистичный фреймворк для быстрого создания Python API");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Flask for lightweight API", "Python team, fast development, web project");
end

// Правило 17: Express.js для простых Node.js проектов
rule "Recommend Express.js for Simple Node.js"
    when
        $req: ProjectRequirements(
            teamExperience == ProjectRequirements.TeamExperience.JAVASCRIPT,
            budget == ProjectRequirements.BudgetLevel.LOW,
            projectType == ProjectRequirements.ProjectType.WEB
        )
        $tech: Technology(
            name == "Express.js",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.80);
        rec.setReason("Express.js - минималистичный фреймворк для простых Node.js приложений");
        rec.setPriority(3);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Express.js for simple projects", "JS team, low budget, web project");
end

// Правило 18: Spring Cloud для микросервисов на Java
rule "Recommend Spring Cloud for Java Microservices"
    when
        $req: ProjectRequirements(
            teamExperience == ProjectRequirements.TeamExperience.JAVA,
            budget == ProjectRequirements.BudgetLevel.ENTERPRISE,
            needHighLoad == true
        )
        $tech: Technology(
            name == "Spring Cloud",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.93);
        rec.setReason("Spring Cloud предоставляет полный стек для enterprise микросервисов на Java");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Spring Cloud for microservices", "Java team, enterprise, high load");
end

// Правило 19: GraphQL для гибких API
rule "Recommend GraphQL for Flexible APIs"
    when
        $req: ProjectRequirements(
            needRealTime == true,
            teamSize == ProjectRequirements.TeamSize.MEDIUM,
            budget == ProjectRequirements.BudgetLevel.HIGH
        )
        $tech: Technology(
            name == "GraphQL",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.79);
        rec.setReason("GraphQL обеспечивает гибкость в работе с данными для сложных API");
        rec.setPriority(3);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("GraphQL for flexible APIs", "Real-time, medium team, high budget");
end

// Правило 20: gRPC для высокопроизводительных сервисов
rule "Recommend gRPC for High Performance Services"
    when
        $req: ProjectRequirements(
            needHighLoad == true,
            teamSize == ProjectRequirements.TeamSize.LARGE,
            budget == ProjectRequirements.BudgetLevel.ENTERPRISE
        )
        $tech: Technology(
            name == "gRPC",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.88);
        rec.setReason("gRPC обеспечивает высокую производительность для межсервисного взаимодействия");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("gRPC for high performance", "High load, large team, enterprise");
end

// Правило 21: React для сложных SPA приложений
rule "Recommend React for Complex SPA Applications"
    when
        $req: ProjectRequirements(
            projectType == ProjectRequirements.ProjectType.WEB,
            teamExperience in (ProjectRequirements.TeamExperience.JAVASCRIPT, ProjectRequirements.TeamExperience.MIXED),
            budget != ProjectRequirements.BudgetLevel.LOW
        )
        $tech: Technology(
            name == "React",
            category == Technology.TechnologyCategory.FRONTEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.92);
        rec.setReason("React с большой экосистемой и сообществом идеален для сложных SPA");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("React for complex SPA", "Web project, JS/Mixed team, not low budget");
end

// Правило 22: Vue.js для быстрой разработки и обучения
rule "Recommend Vue.js for Rapid Development"
    when
        $req: ProjectRequirements(
            timeToMarket == ProjectRequirements.TimeToMarket.FAST,
            teamSize == ProjectRequirements.TeamSize.SMALL,
            teamExperience == ProjectRequirements.TeamExperience.NONE
        )
        $tech: Technology(
            name == "Vue.js",
            category == Technology.TechnologyCategory.FRONTEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.85);
        rec.setReason("Vue.js легко изучать и он позволяет быстро разрабатывать интерфейсы");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Vue.js for rapid development", "Fast time-to-market, small team, no experience");
end

// Правило 23: Angular для enterprise приложений
rule "Recommend Angular for Enterprise Applications"
    when
        $req: ProjectRequirements(
            budget == ProjectRequirements.BudgetLevel.ENTERPRISE,
            teamSize == ProjectRequirements.TeamSize.LARGE,
            needHighSecurity == true
        )
        $tech: Technology(
            name == "Angular",
            category == Technology.TechnologyCategory.FRONTEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.90);
        rec.setReason("Angular предоставляет полный фреймворк с TypeScript для больших enterprise приложений");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Angular for enterprise", "Enterprise budget, large team, high security");
end

// Правило 24: React Native для кросс-платформенной мобильной разработки
rule "Recommend React Native for Cross-platform Mobile"
    when
        $req: ProjectRequirements(
            projectType == ProjectRequirements.ProjectType.MOBILE,
            teamExperience == ProjectRequirements.TeamExperience.JAVASCRIPT,
            budget == ProjectRequirements.BudgetLevel.MEDIUM
        )
        $tech: Technology(
            name == "React Native",
            category == Technology.TechnologyCategory.FRONTEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.87);
        rec.setReason("React Native позволяет разрабатывать для iOS и Android с одним кодом на JavaScript");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("React Native for cross-platform", "Mobile project, JS team, medium budget");
end

// Правило 25: Flutter для производительных мобильных приложений
rule "Recommend Flutter for High Performance Mobile"
    when
        $req: ProjectRequirements(
            projectType == ProjectRequirements.ProjectType.MOBILE,
            needHighLoad == true,
            budget == ProjectRequirements.BudgetLevel.HIGH
        )
        $tech: Technology(
            name == "Flutter",
            category == Technology.TechnologyCategory.FRONTEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.89);
        rec.setReason("Flutter обеспечивает нативную производительность с кроссплатформенной разработкой");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Flutter for performance", "Mobile project, high load, high budget");
end

// Правило 26: Svelte для небольших быстрых приложений
rule "Recommend Svelte for Small Fast Applications"
    when
        $req: ProjectRequirements(
            teamSize == ProjectRequirements.TeamSize.SMALL,
            timeToMarket == ProjectRequirements.TimeToMarket.FAST,
            budget == ProjectRequirements.BudgetLevel.LOW
        )
        $tech: Technology(
            name == "Svelte",
            category == Technology.TechnologyCategory.FRONTEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.83);
        rec.setReason("Svelte компилируется в эффективный vanilla JavaScript, идеален для небольших проектов");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Svelte for small projects", "Small team, fast development, low budget");
end

// Правило 27: Next.js для SEO-оптимизированных приложений
rule "Recommend Next.js for SEO Optimized Apps"
    when
        $req: ProjectRequirements(
            projectType == ProjectRequirements.ProjectType.WEB,
            needHighLoad == true,
            teamExperience == ProjectRequirements.TeamExperience.JAVASCRIPT
        )
        $tech: Technology(
            name == "Next.js",
            category == Technology.TechnologyCategory.FRONTEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.86);
        rec.setReason("Next.js обеспечивает server-side rendering для лучшей SEO оптимизации");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Next.js for SEO", "Web project, high load, JS team");
end

// Правило 28: Nuxt.js для Vue.js с SSR
rule "Recommend Nuxt.js for Vue SSR"
    when
        $req: ProjectRequirements(
            projectType == ProjectRequirements.ProjectType.WEB,
            needHighLoad == true
        )
        $tech: Technology(
            name == "Nuxt.js",
            category == Technology.TechnologyCategory.FRONTEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.82);
        rec.setReason("Nuxt.js добавляет server-side rendering к Vue.js для лучшей производительности");
        rec.setPriority(3);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Nuxt.js for Vue SSR", "Web project, high load");
end

// Правило 29: TypeScript для enterprise JavaScript проектов
rule "Recommend TypeScript for Enterprise JavaScript"
    when
        $req: ProjectRequirements(
            budget == ProjectRequirements.BudgetLevel.ENTERPRISE,
            teamSize == ProjectRequirements.TeamSize.LARGE,
            needHighSecurity == true
        )
        $tech: Technology(
            name == "TypeScript",
            category == Technology.TechnologyCategory.FRONTEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.94);
        rec.setReason("TypeScript добавляет статическую типизацию для повышения надежности enterprise приложений");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("TypeScript for enterprise JS", "Enterprise, large team, high security");
end

// Правило 30: Redux для управления состоянием в больших приложениях
rule "Recommend Redux for Large Application State"
    when
        $req: ProjectRequirements(
            teamSize == ProjectRequirements.TeamSize.LARGE,
            budget == ProjectRequirements.BudgetLevel.HIGH,
            projectType == ProjectRequirements.ProjectType.WEB
        )
        $tech: Technology(
            name == "Redux",
            category == Technology.TechnologyCategory.FRONTEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.80);
        rec.setReason("Redux обеспечивает предсказуемое управление состоянием в больших приложениях");
        rec.setPriority(3);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Redux for state management", "Large team, high budget, web project");
end

// Правило 31: PostgreSQL для сложных транзакций и ACID
rule "Recommend PostgreSQL for Complex Transactions"
    when
        $req: ProjectRequirements(
            needHighSecurity == true,
            budget != ProjectRequirements.BudgetLevel.LOW
        )
        $tech: Technology(
            name == "PostgreSQL",
            category == Technology.TechnologyCategory.DATABASE
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.95);
        rec.setReason("PostgreSQL обеспечивает полную ACID compliance и расширенные возможности SQL");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("PostgreSQL for transactions", "High security, not low budget");
end

// Правило 32: MongoDB для гибкой схемы и быстрого старта
rule "Recommend MongoDB for Flexible Schema"
    when
        $req: ProjectRequirements(
            timeToMarket == ProjectRequirements.TimeToMarket.FAST,
            teamSize == ProjectRequirements.TeamSize.SMALL
        )
        $tech: Technology(
            name == "MongoDB",
            category == Technology.TechnologyCategory.DATABASE
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.88);
        rec.setReason("MongoDB позволяет быстро итерировать схему данных на ранних стадиях проекта");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("MongoDB for flexible schema", "Fast development, small team");
end

// Правило 33: Redis для кэширования и real-time данных
rule "Recommend Redis for Caching and Real-time"
    when
        $req: ProjectRequirements(
            needRealTime == true,
            needHighLoad == true
        )
        $tech: Technology(
            name == "Redis",
            category == Technology.TechnologyCategory.DATABASE
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.90);
        rec.setReason("Redis как in-memory data store идеален для кэширования и real-time приложений");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Redis for caching", "Real-time, high load");
end

// Правило 34: MySQL для веб-приложений с ограниченным бюджетом
rule "Recommend MySQL for Budget Web Applications"
    when
        $req: ProjectRequirements(
            budget == ProjectRequirements.BudgetLevel.LOW,
            projectType == ProjectRequirements.ProjectType.WEB
        )
        $tech: Technology(
            name == "MySQL",
            category == Technology.TechnologyCategory.DATABASE
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.82);
        rec.setReason("MySQL - надежная и проверенная СУБД для веб-приложений с ограниченным бюджетом");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("MySQL for budget web", "Low budget, web project");
end

// Правило 35: Cassandra для больших данных и горизонтального масштабирования
rule "Recommend Cassandra for Big Data Scaling"
    when
        $req: ProjectRequirements(
            needHighLoad == true,
            budget == ProjectRequirements.BudgetLevel.ENTERPRISE
        )
        $tech: Technology(
            name == "Apache Cassandra",
            category == Technology.TechnologyCategory.DATABASE
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.87);
        rec.setReason("Cassandra обеспечивает линейное горизонтальное масштабирование для больших данных");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Cassandra for big data", "High load, enterprise budget");
end

// Правило 36: Elasticsearch для поиска и аналитики
rule "Recommend Elasticsearch for Search and Analytics"
    when
        $req: ProjectRequirements(
            needRealTime == true,
            teamSize == ProjectRequirements.TeamSize.MEDIUM,
            budget == ProjectRequirements.BudgetLevel.HIGH
        )
        $tech: Technology(
            name == "Elasticsearch",
            category == Technology.TechnologyCategory.DATABASE
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.85);
        rec.setReason("Elasticsearch обеспечивает мощный полнотекстовый поиск и аналитику в реальном времени");
        rec.setPriority(3);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Elasticsearch for search", "Real-time, medium team, high budget");
end

// Правило 37: SQLite для встроенных и мобильных приложений
rule "Recommend SQLite for Embedded and Mobile"
    when
        $req: ProjectRequirements(
            projectType in (ProjectRequirements.ProjectType.MOBILE, ProjectRequirements.ProjectType.DESKTOP),
            teamSize == ProjectRequirements.TeamSize.SMALL
        )
        $tech: Technology(
            name == "SQLite",
            category == Technology.TechnologyCategory.DATABASE
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.89);
        rec.setReason("SQLite - встроенная СУБД, идеальная для мобильных и десктоп приложений");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("SQLite for embedded", "Mobile/Desktop project, small team");
end

// Правило 38: DynamoDB для serverless архитектуры на AWS
rule "Recommend DynamoDB for AWS Serverless"
    when
        $req: ProjectRequirements(
            budget == ProjectRequirements.BudgetLevel.HIGH,
            needHighLoad == true
        )
        $tech: Technology(
            name == "Amazon DynamoDB",
            category == Technology.TechnologyCategory.DATABASE
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.83);
        rec.setReason("DynamoDB обеспечивает автоматическое масштабирование для serverless приложений на AWS");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("DynamoDB for serverless", "High budget, high load");
end

// Правило 39: Neo4j для графовых данных
rule "Recommend Neo4j for Graph Data"
    when
        $req: ProjectRequirements(
            projectType == ProjectRequirements.ProjectType.AI_ML,
            budget == ProjectRequirements.BudgetLevel.HIGH
        )
        $tech: Technology(
            name == "Neo4j",
            category == Technology.TechnologyCategory.DATABASE
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.86);
        rec.setReason("Neo4j - ведущая графовая СУБД для работы со сложными связанными данными");
        rec.setPriority(3);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Neo4j for graph data", "AI/ML project, high budget");
end

// Правило 40: TimescaleDB для временных рядов
rule "Recommend TimescaleDB for Time Series"
    when
        $req: ProjectRequirements(
            needRealTime == true,
            teamSize == ProjectRequirements.TeamSize.MEDIUM
        )
        $tech: Technology(
            name == "TimescaleDB",
            category == Technology.TechnologyCategory.DATABASE
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.84);
        rec.setReason("TimescaleDB оптимизирован для хранения и обработки данных временных рядов");
        rec.setPriority(3);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("TimescaleDB for time series", "Real-time, medium team");
end

// Правило 41: Docker для контейнеризации приложений
rule "Recommend Docker for Containerization"
    when
        $req: ProjectRequirements(
            budget != ProjectRequirements.BudgetLevel.LOW,
            teamSize != ProjectRequirements.TeamSize.SMALL
        )
        $tech: Technology(
            name == "Docker",
            category == Technology.TechnologyCategory.DEVOPS
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.92);
        rec.setReason("Docker стандартизирует развертывание приложений через контейнеризацию");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Docker for containerization", "Not low budget, not small team");
end

// Правило 42: Kubernetes для оркестрации контейнеров
rule "Recommend Kubernetes for Container Orchestration"
    when
        $req: ProjectRequirements(
            needHighLoad == true,
            teamSize == ProjectRequirements.TeamSize.LARGE,
            budget == ProjectRequirements.BudgetLevel.ENTERPRISE
        )
        $tech: Technology(
            name == "Kubernetes",
            category == Technology.TechnologyCategory.DEVOPS
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.94);
        rec.setReason("Kubernetes обеспечивает автоматическое масштабирование и управление контейнерами");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Kubernetes for orchestration", "High load, large team, enterprise");
end

// Правило 43: Jenkins для CI/CD в enterprise проектах
rule "Recommend Jenkins for Enterprise CI/CD"
    when
        $req: ProjectRequirements(
            budget == ProjectRequirements.BudgetLevel.ENTERPRISE,
            teamSize == ProjectRequirements.TeamSize.LARGE
        )
        $tech: Technology(
            name == "Jenkins",
            category == Technology.TechnologyCategory.DEVOPS
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.88);
        rec.setReason("Jenkins - проверенное решение для CI/CD в enterprise среде");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Jenkins for CI/CD", "Enterprise budget, large team");
end

// Правило 44: GitHub Actions для современных проектов
rule "Recommend GitHub Actions for Modern Projects"
    when
        $req: ProjectRequirements(
            timeToMarket == ProjectRequirements.TimeToMarket.FAST,
            teamSize == ProjectRequirements.TeamSize.SMALL
        )
        $tech: Technology(
            name == "GitHub Actions",
            category == Technology.TechnologyCategory.DEVOPS
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.86);
        rec.setReason("GitHub Actions предоставляет интегрированный CI/CD для быстрого развертывания");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("GitHub Actions for CI/CD", "Fast development, small team");
end

// Правило 45: Terraform для Infrastructure as Code
rule "Recommend Terraform for Infrastructure as Code"
    when
        $req: ProjectRequirements(
            budget == ProjectRequirements.BudgetLevel.ENTERPRISE,
            needHighLoad == true
        )
        $tech: Technology(
            name == "Terraform",
            category == Technology.TechnologyCategory.DEVOPS
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.90);
        rec.setReason("Terraform позволяет управлять инфраструктурой как кодом для consistency и повторяемости");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Terraform for IaC", "Enterprise budget, high load");
end

// Правило 46: Ansible для configuration management
rule "Recommend Ansible for Configuration Management"
    when
        $req: ProjectRequirements(
            teamSize == ProjectRequirements.TeamSize.MEDIUM,
            budget == ProjectRequirements.BudgetLevel.HIGH
        )
        $tech: Technology(
            name == "Ansible",
            category == Technology.TechnologyCategory.DEVOPS
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.85);
        rec.setReason("Ansible упрощает управление конфигурациями через YAML и agentless архитектуру");
        rec.setPriority(3);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Ansible for configuration", "Medium team, high budget");
end

// Правило 47: Prometheus для мониторинга
rule "Recommend Prometheus for Monitoring"
    when
        $req: ProjectRequirements(
            needHighLoad == true,
            budget == ProjectRequirements.BudgetLevel.HIGH
        )
        $tech: Technology(
            name == "Prometheus",
            category == Technology.TechnologyCategory.DEVOPS
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.87);
        rec.setReason("Prometheus - стандарт для мониторинга контейнеризированных приложений");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Prometheus for monitoring", "High load, high budget");
end

// Правило 48: Grafana для визуализации метрик
rule "Recommend Grafana for Metrics Visualization"
    when
        $req: ProjectRequirements(
            teamSize == ProjectRequirements.TeamSize.MEDIUM,
            budget != ProjectRequirements.BudgetLevel.LOW
        )
        $tech: Technology(
            name == "Grafana",
            category == Technology.TechnologyCategory.DEVOPS
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.83);
        rec.setReason("Grafana предоставляет мощные дашборды для визуализации метрик из различных источников");
        rec.setPriority(3);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Grafana for visualization", "Medium team, not low budget");
end

// Правило 49: AWS для enterprise cloud
rule "Recommend AWS for Enterprise Cloud"
    when
        $req: ProjectRequirements(
            budget == ProjectRequirements.BudgetLevel.ENTERPRISE,
            needHighLoad == true
        )
        $tech: Technology(
            name == "Amazon Web Services",
            category == Technology.TechnologyCategory.DEVOPS
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.95);
        rec.setReason("AWS предоставляет наиболее полный набор сервисов для enterprise cloud решений");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("AWS for enterprise cloud", "Enterprise budget, high load");
end

// Правило 50: Azure для .NET и Microsoft экосистемы
rule "Recommend Azure for Microsoft Ecosystem"
    when
        $req: ProjectRequirements(
            teamExperience == ProjectRequirements.TeamExperience.DOTNET,
            budget == ProjectRequirements.BudgetLevel.ENTERPRISE
        )
        $tech: Technology(
            name == "Microsoft Azure",
            category == Technology.TechnologyCategory.DEVOPS
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.92);
        rec.setReason("Azure обеспечивает лучшую интеграцию с .NET и Microsoft экосистемой");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Azure for Microsoft ecosystem", ".NET team, enterprise budget");
end

// Правило 51: JWT для аутентификации в распределенных системах
rule "Recommend JWT for Distributed Authentication"
    when
        $req: ProjectRequirements(
            needHighSecurity == true,
            teamSize == ProjectRequirements.TeamSize.MEDIUM
        )
        $tech: Technology(
            name == "JSON Web Tokens",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.88);
        rec.setReason("JWT обеспечивает stateless аутентификацию для распределенных систем");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("JWT for authentication", "High security, medium team");
end

// Правило 52: OAuth 2.0 для социальной аутентификации
rule "Recommend OAuth 2.0 for Social Authentication"
    when
        $req: ProjectRequirements(
            projectType == ProjectRequirements.ProjectType.WEB,
            budget == ProjectRequirements.BudgetLevel.MEDIUM
        )
        $tech: Technology(
            name == "OAuth 2.0",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.85);
        rec.setReason("OAuth 2.0 - стандарт для социальной аутентификации и авторизации");
        rec.setPriority(3);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("OAuth 2.0 for social auth", "Web project, medium budget");
end

// Правило 53: Kafka для обработки потоков данных
rule "Recommend Kafka for Stream Processing"
    when
        $req: ProjectRequirements(
            needRealTime == true,
            needHighLoad == true,
            budget == ProjectRequirements.BudgetLevel.ENTERPRISE
        )
        $tech: Technology(
            name == "Apache Kafka",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.91);
        rec.setReason("Kafka - лидер в обработке потоков данных в реальном времени");
        rec.setPriority(1);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("Kafka for stream processing", "Real-time, high load, enterprise");
end

// Правило 54: RabbitMQ для message queue
rule "Recommend RabbitMQ for Message Queue"
    when
        $req: ProjectRequirements(
            needRealTime == true,
            teamSize == ProjectRequirements.TeamSize.MEDIUM
        )
        $tech: Technology(
            name == "RabbitMQ",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.84);
        rec.setReason("RabbitMQ предоставляет надежную систему очередей сообщений");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.ALTERNATIVE);
        recommendations.add(rec);
        auditLogService.logRuleActivation("RabbitMQ for message queue", "Real-time, medium team");
end

// Правило 55: Swagger/OpenAPI для документирования API
rule "Recommend OpenAPI for API Documentation"
    when
        $req: ProjectRequirements(
            teamSize == ProjectRequirements.TeamSize.MEDIUM,
            budget == ProjectRequirements.BudgetLevel.HIGH
        )
        $tech: Technology(
            name == "OpenAPI (Swagger)",
            category == Technology.TechnologyCategory.BACKEND
        )
    then
        TechnologyRecommendation rec = new TechnologyRecommendation();
        rec.setTechnology($tech);
        rec.setConfidence(0.89);
        rec.setReason("OpenAPI стандартизирует документацию и тестирование REST API");
        rec.setPriority(2);
        rec.setStatus(TechnologyRecommendation.RecommendationStatus.PRIMARY);
        recommendations.add(rec);
        auditLogService.logRuleActivation("OpenAPI for API docs", "Medium team, high budget");
end